# 部署故障排除与维护

本指南详细介绍子应用部署过程中可能遇到的问题及其解决方案，以及部署后的维护操作。

## 故障排除

### 构建失败

如果构建失败，请检查以下几点：

1. 依赖安装是否成功
2. `pnpm build` 命令是否能在本地正常运行
3. 是否有 TypeScript 或其他编译错误

### 部署失败

如果部署失败，请检查以下几点：

1. Vercel 令牌是否正确且未过期
2. `VERCEL_ORG_ID` 和 `VERCEL_PROJECT_ID` 是否正确
3. GitHub Actions secrets 是否已正确设置

### 微前端集成问题

如果子应用无法正确加载：

1. 检查子应用的 Vercel 部署地址是否正确
2. 检查主应用中子应用的 entry 配置是否正确
3. 检查子应用的 base 路径配置是否与 activeRule 一致
4. 检查浏览器控制台是否有跨域错误

## 本地测试

在推送代码之前，建议在本地测试构建过程：

```bash
# 安装依赖
pnpm install

# 构建项目
pnpm build

# 预览构建结果
pnpm preview
```

## 监控和日志

你可以在以下位置查看部署状态和日志：

1. GitHub Actions: 仓库的 Actions 选项卡
2. Vercel 控制台: 项目的部署历史和日志

## 回滚操作

如果需要回滚到之前的部署版本：

1. 在 Vercel 控制台的 "Deployments" 页面
2. 找到要回滚到的部署版本
3. 点击 "Promote to Production" 按钮

## 性能优化

### 构建优化

1. 使用 Vercel 的缓存机制优化构建速度
2. 合理配置构建产物的缓存策略
3. 优化资源文件大小

### 资源加载优化

1. 合理设置静态资源的缓存头
2. 使用 CDN 加速资源加载
3. 压缩图片和其他媒体资源

## 安全考虑

### 访问控制

1. 限制对敏感接口的访问
2. 使用 HTTPS 加密传输
3. 定期更新依赖包以修复安全漏洞

### 环境变量安全

1. 不要在代码中硬编码敏感信息
2. 使用 Vercel 的环境变量管理敏感配置
3. 为不同环境设置不同的环境变量

## 最佳实践

### 版本管理

1. 维护子应用的版本号
2. 在配置中记录版本信息，便于问题排查

### 配置管理

1. 使用环境变量管理不同环境的配置
2. 避免在代码中硬编码部署地址

### 监控和日志

1. 实现应用性能监控
2. 记录关键操作日志
3. 设置错误告警机制